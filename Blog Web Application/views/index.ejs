<%- include('partials/header') %>

<section class="grid grid-two">
  <div>
    <h2>Create a Post</h2>
    <% if (typeof error !== "undefined" && error) { %>
      <div class="alert"><%= error %></div>
    <% } %>

    <form action="/posts" method="POST" class="card form-card">
      <label for="title">Title</label>
      <input id="title" name="title" type="text" placeholder="Post title..." required />

      <label for="content">Content</label>
      <textarea id="content" name="content" rows="8" placeholder="Write your post..." required></textarea>

      <button type="submit" class="btn primary">Publish</button>
    </form>
  </div>

  <div>
    <h2>Recent Posts</h2>
    <% if (posts.length === 0) { %>
      <p class="muted">No posts yet â€” be the first to publish!</p>
    <% } %>

    <div class="post-list">
      <% posts.forEach(function(post){ %>
        <article class="card post-card">
          <h3 class="post-title">
            <a href="/posts/<%= post.id %>"><%= post.title %></a>
          </h3>
          <p class="post-meta">Updated <%= new Date(post.updatedAt).toLocaleString() %></p>
          <p class="post-excerpt">
            <%= post.content.length > 160 ? post.content.slice(0, 160) + "..." : post.content %>
          </p>
          <div class="actions">
            <a class="btn" href="/posts/<%= post.id %>">Read</a>
            <a class="btn" href="/posts/<%= post.id %>/edit">Edit</a>
            <form action="/posts/<%= post.id %>/delete" method="POST" onsubmit="return confirm('Delete this post?');">
              <button type="submit" class="btn danger">Delete</button>
            </form>
          </div>
        </article>
      <% }) %>
    </div>
  </div>
</section>

<%- include('partials/footer') %>
